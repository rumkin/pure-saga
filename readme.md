# Pure Saga

![Build](https://img.shields.io/travis/rumkin/pure-saga.svg)

Pure saga is a functional implementation of generator based asyncronous flow
manager based on effects yielding.

## Installation

Via npm:
```shell
npm i pure-saga
```

Or via unpkg.com:

```html
<script src="https://unpkg.com/pure-saga@3/dist/pure-saga.js"></script>
<script src="https://unpkg.com/pure-saga@3/dist/pure-saga.min.js"></script>
```

## Usage

Pure-saga allow you to define your own effects to work with any kind
of side effects. It has pretty simple interface `createSaga(generatorFunc, sagaEffects)`.
This function return promisified saga generator. See example of how to use it.

## Example

This example shows how to create API for saga like this:
```javascript

// Side effects handlers get instructions generated by factories and produce
// result. Side effect could return promises.
const effectHandlers = {
    api: ({method, args}) => api[method](...args),
    storePut: ({id, item}) => store.set(id, item),
    storeGet: ({id, item}) => store.get(id),
};

// Example saga generator function
function * loadUserSaga(userId) {
    // Retrieve user calling api.loadUser method
    const user = yield effect.api('loadUser', userId);
    // Put user to store
    yield effects.store.put(user.id, user);
}

// Define some goodies for easy effect creation.
const createEffect = (type, payload) => ({type, payload});

// Effects factory
const effects = {
    api: (method, ...args) => createEffect('api', {method, args}),
    store: {
        put: (id, item) => createEffect('storePut', {id, item}),
        get: (id) => createEffect('storeGet', {id}),
    },
};

// Create method
const loadUser = createSaga(loadUserSaga, effectHandlers);

// Use it
loadUser(1)
.catch((error) => console.error(error));
```

## Testing

Test example.

```javascript
function * getUserSaga() {
    const user = yield effect.get('user');

    return user;
}

describe('getUserSaga', () => {
    it('Should yield `get` effect', () => {
        const it = getUserSaga();

        const effect = it.next().value;

        // Check effect to be an instanceof get effect.
        should(effect).be.deepEqual({
            type: 'get',
            payload: {
                key: 'user',
            },
        });

        const user = {name: 'user'};
        const result = it.next(user).value;

        should(result).be.deepEqual(user);
    });
});
```

# License

MIT.
